import{a as E,t as x}from"../chunks/DldL76JG.js";import{i as C}from"../chunks/BU0KUimQ.js";import{p as D,o as U,a as B,n as F}from"../chunks/DQ3YwMtn.js";import"../chunks/DS8qDkxA.js";var L=x('<h1>libheif.js demo</h1> <p><input type="file" id="upload" accept="image/heic"> <button id="download" disabled>Download</button></p> <canvas class="svelte-1ork3xe"></canvas>',1);function _(w,f){D(f,!1);let l;async function m(){const i=await(await fetch("../node_modules/libheif-js/libheif-wasm/libheif.wasm")).arrayBuffer();l=libheif({wasmBinary:i})}U(async()=>{await m();const c=document.querySelector("#upload"),i=document.querySelector("#download"),s=document.querySelector("canvas"),p=n=>new Promise((r,e)=>{const a=new FileReader;a.onload=o=>{o.target&&o.target.result?r(new Uint8Array(o.target.result)):e(new Error("File reading error"))},a.onerror=o=>e(o),a.readAsArrayBuffer(n)}),h=async n=>{const e=new l().decode(n)[0],a=e.get_width(),o=e.get_height();if(!s)throw new Error("Canvas not found");s.width=a,s.height=o;const t=s.getContext("2d");if(!t)throw new Error("Context not found");const d=t.createImageData(a,o);await new Promise((y,b)=>{e.display(d,v=>{v?(t.putImageData(d,0,0),y()):b(new Error("HEIF processing error"))})})},g=()=>new Promise((n,r)=>{if(!s)throw new Error("Canvas not found");s.toBlob(e=>{e?n(e):r(new Error("failed to convert the image"))})});if(!c)throw new Error("Upload element not found");c.addEventListener("change",async n=>{const r=n.target,e=r.files?r.files[0]:null;if(e){const a=await p(e);if(await h(a),!i)throw new Error("Download element not found");const o=await g();i.onclick=()=>{const t=document.createElement("a");document.body.appendChild(t),t.style.display="none";const d=window.URL.createObjectURL(o);t.href=d,t.download="result.jpg",t.click(),window.URL.revokeObjectURL(d),t.remove()},i.disabled=!1}})}),C();var u=L();F(4),E(w,u),B()}export{_ as component};
