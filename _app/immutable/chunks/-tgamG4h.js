var Ge=Object.defineProperty;var Qe=Object.getPrototypeOf;var We=Reflect.get;var ve=e=>{throw TypeError(e)};var Xe=(e,t,r)=>t in e?Ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var p=(e,t,r)=>Xe(e,typeof t!="symbol"?t+"":t,r),ie=(e,t,r)=>t.has(e)||ve("Cannot "+r);var l=(e,t,r)=>(ie(e,t,"read from private field"),r?r.call(e):t.get(e)),y=(e,t,r)=>t.has(e)?ve("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),x=(e,t,r,s)=>(ie(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),E=(e,t,r)=>(ie(e,t,"access private method"),r);var we=(e,t,r)=>We(Qe(e),r,t);import{aC as Ye,h as ee,aJ as Ze,aK as Je,aL as et,Z as k,aM as tt,k as w,b as rt,u as st,aE as nt,R,aF as it,aN as at,ak as ot}from"./l1OLxsb_.js";import{j as ct,o as lt}from"./BbMFh2fa.js";import{p as H,_ as ut}from"./Cfghn68g.js";function tr(e){if(ee){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;be(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var n=e.checked;be(e,"checked",null),e.checked=n}}};e.__on_r=r,Je(r),ct()}}function be(e,t,r,s){var n=e.__attributes??(e.__attributes={});ee&&(n[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||n[t]!==(n[t]=r)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[et]=r),r==null?e.removeAttribute(t):typeof r!="string"&&ft(e).includes(t)?e[t]=r:e.setAttribute(t,r))}var Pe=new Map;function ft(e){var t=Pe.get(e.nodeName);if(t)return t;Pe.set(e.nodeName,t=[]);for(var r,s=e,n=Element.prototype;n!==s;){r=Ze(s);for(var i in r)r[i].set&&t.push(i);s=Ye(s)}return t}function rr(e,t,r){var s=e.__className,n=dt(t);ee&&e.className===n?e.__className=n:(s!==n||ee&&e.className!==n)&&(t==null?e.removeAttribute("class"):e.className=n,e.__className=n)}function dt(e,t){return(e??"")+""}function F(e){k(e,e.v+1)}function mt(e){let t=0,r=R(0),s;return()=>{tt()&&(w(r),rt(()=>(t===0&&(s=st(()=>e(()=>F(r)))),t+=1,()=>{nt().then(()=>{t-=1,t===0&&(s==null||s(),s=void 0)})})))}}var S,I,_,z,Y;const ye=class ye extends Map{constructor(r){super();y(this,z);y(this,S,new Map);y(this,I,R(0));y(this,_,R(0));if(r){for(var[s,n]of r)super.set(s,n);l(this,_).v=super.size}}has(r){var s=l(this,S),n=s.get(r);if(n===void 0){var i=super.get(r);if(i!==void 0)n=R(0),s.set(r,n);else return w(l(this,I)),!1}return w(n),!0}forEach(r,s){E(this,z,Y).call(this),super.forEach(r,s)}get(r){var s=l(this,S),n=s.get(r);if(n===void 0){var i=super.get(r);if(i!==void 0)n=R(0),s.set(r,n);else{w(l(this,I));return}}return w(n),super.get(r)}set(r,s){var b;var n=l(this,S),i=n.get(r),a=super.get(r),c=super.set(r,s),u=l(this,I);if(i===void 0)n.set(r,R(0)),k(l(this,_),super.size),F(u);else if(a!==s){F(i);var m=u.reactions===null?null:new Set(u.reactions),d=m===null||!((b=i.reactions)!=null&&b.every(T=>m.has(T)));d&&F(u)}return c}delete(r){var s=l(this,S),n=s.get(r),i=super.delete(r);return n!==void 0&&(s.delete(r),k(l(this,_),super.size),k(n,-1),F(l(this,I))),i}clear(){if(super.size!==0){super.clear();var r=l(this,S);k(l(this,_),0);for(var s of r.values())k(s,-1);F(l(this,I)),r.clear()}}keys(){return w(l(this,I)),super.keys()}values(){return E(this,z,Y).call(this),super.values()}entries(){return E(this,z,Y).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return w(l(this,_)),super.size}};S=new WeakMap,I=new WeakMap,_=new WeakMap,z=new WeakSet,Y=function(){w(l(this,I));var r=l(this,S);if(l(this,_).v!==r.size)for(var s of we(ye.prototype,this,"keys").call(this))r.has(s)||r.set(s,R(0));for(var[,n]of l(this,S))w(n)};let le=ye;class gt{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(t,r){this.keyToValue.set(t,r),this.valueToKey.set(r,t)}getByKey(t){return this.keyToValue.get(t)}getByValue(t){return this.valueToKey.get(t)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class ke{constructor(t){this.generateIdentifier=t,this.kv=new gt}register(t,r){this.kv.getByValue(t)||(r||(r=this.generateIdentifier(t)),this.kv.set(r,t))}clear(){this.kv.clear()}getIdentifier(t){return this.kv.getByValue(t)}getValue(t){return this.kv.getByKey(t)}}class ht extends ke{constructor(){super(t=>t.name),this.classToAllowedProps=new Map}register(t,r){typeof r=="object"?(r.allowProps&&this.classToAllowedProps.set(t,r.allowProps),super.register(t,r.identifier)):super.register(t,r)}getAllowedProps(t){return this.classToAllowedProps.get(t)}}function pt(e){if("values"in Object)return Object.values(e);const t=[];for(const r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function yt(e,t){const r=pt(e);if("find"in r)return r.find(t);const s=r;for(let n=0;n<s.length;n++){const i=s[n];if(t(i))return i}}function M(e,t){Object.entries(e).forEach(([r,s])=>t(s,r))}function Z(e,t){return e.indexOf(t)!==-1}function Se(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(t(s))return s}}class vt{constructor(){this.transfomers={}}register(t){this.transfomers[t.name]=t}findApplicable(t){return yt(this.transfomers,r=>r.isApplicable(t))}findByName(t){return this.transfomers[t]}}const wt=e=>Object.prototype.toString.call(e).slice(8,-1),Ae=e=>typeof e>"u",bt=e=>e===null,U=e=>typeof e!="object"||e===null||e===Object.prototype?!1:Object.getPrototypeOf(e)===null?!0:Object.getPrototypeOf(e)===Object.prototype,ue=e=>U(e)&&Object.keys(e).length===0,N=e=>Array.isArray(e),Pt=e=>typeof e=="string",St=e=>typeof e=="number"&&!isNaN(e),It=e=>typeof e=="boolean",_t=e=>e instanceof RegExp,K=e=>e instanceof Map,j=e=>e instanceof Set,De=e=>wt(e)==="Symbol",Tt=e=>e instanceof Date&&!isNaN(e.valueOf()),Et=e=>e instanceof Error,Ie=e=>typeof e=="number"&&isNaN(e),kt=e=>It(e)||bt(e)||Ae(e)||St(e)||Pt(e)||De(e),At=e=>typeof e=="bigint",Dt=e=>e===1/0||e===-1/0,Nt=e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),Ot=e=>e instanceof URL,Ne=e=>e.replace(/\./g,"\\."),ae=e=>e.map(String).map(Ne).join("."),L=e=>{const t=[];let r="";for(let n=0;n<e.length;n++){let i=e.charAt(n);if(i==="\\"&&e.charAt(n+1)==="."){r+=".",n++;continue}if(i==="."){t.push(r),r="";continue}r+=i}const s=r;return t.push(s),t};function P(e,t,r,s){return{isApplicable:e,annotation:t,transform:r,untransform:s}}const Oe=[P(Ae,"undefined",()=>null,()=>{}),P(At,"bigint",e=>e.toString(),e=>typeof BigInt<"u"?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),P(Tt,"Date",e=>e.toISOString(),e=>new Date(e)),P(Et,"Error",(e,t)=>{const r={name:e.name,message:e.message};return t.allowedErrorProps.forEach(s=>{r[s]=e[s]}),r},(e,t)=>{const r=new Error(e.message);return r.name=e.name,r.stack=e.stack,t.allowedErrorProps.forEach(s=>{r[s]=e[s]}),r}),P(_t,"regexp",e=>""+e,e=>{const t=e.slice(1,e.lastIndexOf("/")),r=e.slice(e.lastIndexOf("/")+1);return new RegExp(t,r)}),P(j,"set",e=>[...e.values()],e=>new Set(e)),P(K,"map",e=>[...e.entries()],e=>new Map(e)),P(e=>Ie(e)||Dt(e),"number",e=>Ie(e)?"NaN":e>0?"Infinity":"-Infinity",Number),P(e=>e===0&&1/e===-1/0,"number",()=>"-0",Number),P(Ot,"URL",e=>e.toString(),e=>new URL(e))];function se(e,t,r,s){return{isApplicable:e,annotation:t,transform:r,untransform:s}}const Re=se((e,t)=>De(e)?!!t.symbolRegistry.getIdentifier(e):!1,(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,r)=>{const s=r.symbolRegistry.getValue(t[1]);if(!s)throw new Error("Trying to deserialize unknown symbol");return s}),Rt=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),Fe=se(Nt,e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{const r=Rt[t[1]];if(!r)throw new Error("Trying to deserialize unknown typed array");return new r(e)});function Ce(e,t){return e!=null&&e.constructor?!!t.classRegistry.getIdentifier(e.constructor):!1}const He=se(Ce,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{const r=t.classRegistry.getAllowedProps(e.constructor);if(!r)return{...e};const s={};return r.forEach(n=>{s[n]=e[n]}),s},(e,t,r)=>{const s=r.classRegistry.getValue(t[1]);if(!s)throw new Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(s.prototype),e)}),ze=se((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,r)=>{const s=r.customTransformerRegistry.findByName(t[1]);if(!s)throw new Error("Trying to deserialize unknown custom value");return s.deserialize(e)}),Ft=[He,Re,ze,Fe],_e=(e,t)=>{const r=Se(Ft,n=>n.isApplicable(e,t));if(r)return{value:r.transform(e,t),type:r.annotation(e,t)};const s=Se(Oe,n=>n.isApplicable(e,t));if(s)return{value:s.transform(e,t),type:s.annotation}},Ve={};Oe.forEach(e=>{Ve[e.annotation]=e});const Ct=(e,t,r)=>{if(N(t))switch(t[0]){case"symbol":return Re.untransform(e,t,r);case"class":return He.untransform(e,t,r);case"custom":return ze.untransform(e,t,r);case"typed-array":return Fe.untransform(e,t,r);default:throw new Error("Unknown transformation: "+t)}else{const s=Ve[t];if(!s)throw new Error("Unknown transformation: "+t);return s.untransform(e,r)}},C=(e,t)=>{if(t>e.size)throw new Error("index out of bounds");const r=e.keys();for(;t>0;)r.next(),t--;return r.next().value};function $e(e){if(Z(e,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(Z(e,"prototype"))throw new Error("prototype is not allowed as a property");if(Z(e,"constructor"))throw new Error("constructor is not allowed as a property")}const Ht=(e,t)=>{$e(t);for(let r=0;r<t.length;r++){const s=t[r];if(j(e))e=C(e,+s);else if(K(e)){const n=+s,i=+t[++r]==0?"key":"value",a=C(e,n);switch(i){case"key":e=a;break;case"value":e=e.get(a);break}}else e=e[s]}return e},fe=(e,t,r)=>{if($e(t),t.length===0)return r(e);let s=e;for(let i=0;i<t.length-1;i++){const a=t[i];if(N(s)){const c=+a;s=s[c]}else if(U(s))s=s[a];else if(j(s)){const c=+a;s=C(s,c)}else if(K(s)){if(i===t.length-2)break;const u=+a,m=+t[++i]==0?"key":"value",d=C(s,u);switch(m){case"key":s=d;break;case"value":s=s.get(d);break}}}const n=t[t.length-1];if(N(s)?s[+n]=r(s[+n]):U(s)&&(s[n]=r(s[n])),j(s)){const i=C(s,+n),a=r(i);i!==a&&(s.delete(i),s.add(a))}if(K(s)){const i=+t[t.length-2],a=C(s,i);switch(+n==0?"key":"value"){case"key":{const u=r(a);s.set(u,s.get(a)),u!==a&&s.delete(a);break}case"value":{s.set(a,r(s.get(a)));break}}}return e};function de(e,t,r=[]){if(!e)return;if(!N(e)){M(e,(i,a)=>de(i,t,[...r,...L(a)]));return}const[s,n]=e;n&&M(n,(i,a)=>{de(i,t,[...r,...L(a)])}),t(s,r)}function zt(e,t,r){return de(t,(s,n)=>{e=fe(e,n,i=>Ct(i,s,r))}),e}function Vt(e,t){function r(s,n){const i=Ht(e,L(n));s.map(L).forEach(a=>{e=fe(e,a,()=>i)})}if(N(t)){const[s,n]=t;s.forEach(i=>{e=fe(e,L(i),()=>e)}),n&&M(n,r)}else M(t,r);return e}const $t=(e,t)=>U(e)||N(e)||K(e)||j(e)||Ce(e,t);function Mt(e,t,r){const s=r.get(e);s?s.push(t):r.set(e,[t])}function Bt(e,t){const r={};let s;return e.forEach(n=>{if(n.length<=1)return;t||(n=n.map(c=>c.map(String)).sort((c,u)=>c.length-u.length));const[i,...a]=n;i.length===0?s=a.map(ae):r[ae(i)]=a.map(ae)}),s?ue(r)?[s]:[s,r]:ue(r)?void 0:r}const Me=(e,t,r,s,n=[],i=[],a=new Map)=>{const c=kt(e);if(!c){Mt(e,n,t);const g=a.get(e);if(g)return s?{transformedValue:null}:g}if(!$t(e,r)){const g=_e(e,r),h=g?{transformedValue:g.value,annotations:[g.type]}:{transformedValue:e};return c||a.set(e,h),h}if(Z(i,e))return{transformedValue:null};const u=_e(e,r),m=(u==null?void 0:u.value)??e,d=N(m)?[]:{},b={};M(m,(g,h)=>{if(h==="__proto__"||h==="constructor"||h==="prototype")throw new Error(`Detected property ${h}. This is a prototype pollution risk, please remove it from your object.`);const B=Me(g,t,r,s,[...n,h],[...i,e],a);d[h]=B.transformedValue,N(B.annotations)?b[h]=B.annotations:U(B.annotations)&&M(B.annotations,(je,qe)=>{b[Ne(h)+"."+qe]=je})});const T=ue(b)?{transformedValue:d,annotations:u?[u.type]:void 0}:{transformedValue:d,annotations:u?[u.type,b]:b};return c||a.set(e,T),T};function Be(e){return Object.prototype.toString.call(e).slice(8,-1)}function Te(e){return Be(e)==="Array"}function xt(e){if(Be(e)!=="Object")return!1;const t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}function Lt(e,t,r,s,n){const i={}.propertyIsEnumerable.call(s,t)?"enumerable":"nonenumerable";i==="enumerable"&&(e[t]=r),n&&i==="nonenumerable"&&Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0,configurable:!0})}function me(e,t={}){if(Te(e))return e.map(n=>me(n,t));if(!xt(e))return e;const r=Object.getOwnPropertyNames(e),s=Object.getOwnPropertySymbols(e);return[...r,...s].reduce((n,i)=>{if(Te(t.props)&&!t.props.includes(i))return n;const a=e[i],c=me(a,t);return Lt(n,i,c,e,t.nonenumerable),n},{})}class f{constructor({dedupe:t=!1}={}){this.classRegistry=new ht,this.symbolRegistry=new ke(r=>r.description??""),this.customTransformerRegistry=new vt,this.allowedErrorProps=[],this.dedupe=t}serialize(t){const r=new Map,s=Me(t,r,this,this.dedupe),n={json:s.transformedValue};s.annotations&&(n.meta={...n.meta,values:s.annotations});const i=Bt(r,this.dedupe);return i&&(n.meta={...n.meta,referentialEqualities:i}),n}deserialize(t){const{json:r,meta:s}=t;let n=me(r);return s!=null&&s.values&&(n=zt(n,s.values,this)),s!=null&&s.referentialEqualities&&(n=Vt(n,s.referentialEqualities)),n}stringify(t){return JSON.stringify(this.serialize(t))}parse(t){return this.deserialize(JSON.parse(t))}registerClass(t,r){this.classRegistry.register(t,r)}registerSymbol(t,r){this.symbolRegistry.register(t,r)}registerCustom(t,r){this.customTransformerRegistry.register({name:r,...t})}allowErrorProps(...t){this.allowedErrorProps.push(...t)}}f.defaultInstance=new f;f.serialize=f.defaultInstance.serialize.bind(f.defaultInstance);f.deserialize=f.defaultInstance.deserialize.bind(f.defaultInstance);f.stringify=f.defaultInstance.stringify.bind(f.defaultInstance);f.parse=f.defaultInstance.parse.bind(f.defaultInstance);f.registerClass=f.defaultInstance.registerClass.bind(f.defaultInstance);f.registerSymbol=f.defaultInstance.registerSymbol.bind(f.defaultInstance);f.registerCustom=f.defaultInstance.registerCustom.bind(f.defaultInstance);f.allowErrorProps=f.defaultInstance.allowErrorProps.bind(f.defaultInstance);const Ut=window;function Kt(e,t){switch(e){case"local":return t.localStorage;case"session":return t.sessionStorage}}var A,D,V,$,q,re,O,ge,he;class jt{constructor(t,r,s={}){y(this,O);y(this,A,it());y(this,D);y(this,V);y(this,$);y(this,q);y(this,re,t=>{t.key!==l(this,D)||t.newValue===null||E(this,O,ge).call(this,t.newValue)});const{storage:n="local",serializer:i={serialize:f.stringify,deserialize:f.parse},syncTabs:a=!0,window:c=Ut}=s;if(l(this,A).v=H(r),x(this,D,t),x(this,V,i),c===void 0)return;const u=Kt(n,c);x(this,$,u);const m=u.getItem(t);m!==null&&E(this,O,ge).call(this,m),a&&n==="local"&&x(this,q,mt(()=>lt(c,"storage",l(this,re)))),at(()=>{ot(()=>{var d;(d=l(this,q))==null||d.call(this),E(this,O,he).call(this,w(l(this,A)))})})}get v(){return w(l(this,A))}set v(t){k(l(this,A),H(t)),E(this,O,he).call(this,t)}}A=new WeakMap,D=new WeakMap,V=new WeakMap,$=new WeakMap,q=new WeakMap,re=new WeakMap,O=new WeakSet,ge=function(t){try{k(l(this,A),H(l(this,V).deserialize(t)))}catch(r){console.error(`Error when parsing "${t}" from persisted store "${l(this,D)}"`,r)}},he=function(t){var r;try{(r=l(this,$))==null||r.setItem(l(this,D),l(this,V).serialize(t))}catch(s){console.error(`Error when writing value from persisted store "${l(this,D)}" to ${l(this,$)}`,s)}};function G(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function qt(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=G(r);return(n,i)=>s.then(a=>i(a.transaction(t,n).objectStore(t)))}let oe;function ne(){return oe||(oe=qt("keyval-store","keyval")),oe}function te(e,t=ne()){return t("readonly",r=>G(r.get(e)))}function xe(e,t,r=ne()){return r("readwrite",s=>(s.put(t,e),G(s.transaction)))}function Gt(e,t=ne()){return t("readwrite",r=>(r.delete(e),G(r.transaction)))}function Qt(e=ne()){return e("readwrite",t=>(t.clear(),G(t.transaction)))}async function sr(e,t=!1,r=!1){try{let s;t?s=await te(e).then(i=>i):s=await window.showDirectoryPicker();const n=s.name;e==="v1"?(v.v.v1DirPath=n,o.v1DirFileSysHandle=s,ce("v1",s)):e==="v2"?(v.v.v2DirPath=n,o.v2DirFileSysHandle=s,ce("v2",s)):e==="convOut"&&(v.v.otherDirs.convOut=n,o.converter.outputDirFileSysHandle=s,ce("convOut",s)),Wt(r)}catch{console.log("Directory picker canceled")}}async function Wt(e=!1){var i;v.v.dirsOk=!1;let t=[],r=[];if(o.v1DirFileSysHandle&&(t=await Ee(o.v1DirFileSysHandle),o.v1Len=t.length),o.v2DirFileSysHandle&&(r=await Ee(o.v2DirFileSysHandle),o.v2Len=r.length),(!o.v1DirFileSysHandle||!o.v2DirFileSysHandle)&&!e)return;v.v.dirsOk=!0;const s=new Map(t.map(a=>[a.name.split(".")[0],a])),n=new Map(r.map(a=>[a.name.split(".")[0],a]));if(o.imagePairsAll=Array.from(new Set([...s.keys(),...n.keys()])).map(a=>({baseName:a,v1:s.get(a),v2:n.get(a)})),o.overlaps=o.imagePairsAll.filter(a=>a.v1&&a.v2).length,o.imagePairsAll.sort((a,c)=>a.baseName.localeCompare(c.baseName)),o.imagePairsHeic=o.imagePairsAll.filter(a=>{var c,u;return((c=a.v1)==null?void 0:c.name.match(/\.heic$/i))||((u=a.v2)==null?void 0:u.name.match(/\.heic$/i))}),o.heicCount=o.imagePairsHeic.length,o.imagePairs=o.imagePairsAll.filter(a=>{var c,u;return!((c=a.v1)!=null&&c.name.match(/\.heic$/i))&&!((u=a.v2)!=null&&u.name.match(/\.heic$/i))}),o.imagePairsHeic.length>0){const a=o.imagePairsHeic[0];o.whichFolderHeic=(i=a.v1)!=null&&i.name.match(/\.heic$/i)?"v1":"v2"}Le(v.v.defaultSelection)}async function Ee(e){const t=[];for await(const r of e.values())r.kind==="file"&&r.name.match(/\.(png|jpg|jpeg|gif|webp|heic)$/i)&&t.push({handle:r,name:r.name,url:URL.createObjectURL(await r.getFile())});return t}function Le(e){e===""&&o.selections.clear(),o.imagePairs.forEach(t=>{e==="v1"&&t.v1?o.selections.set(t.baseName,"v1"):e==="v2"&&t.v2&&o.selections.set(t.baseName,"v2")}),pe()}function pe(){let e=0,t=0;o.selections.forEach(r=>{r==="v1"?e++:r==="v2"&&t++}),o.status={v1:e,v2:t}}function J(e,t,r=!1){e==null||e==null||(o.selections.set(e,t),r||pe())}function nr(){const e=o.imagePairs.findIndex(a=>{var c;return a.baseName===((c=o.currentPair)==null?void 0:c.baseName)});if(e===-1)return o.imagePairs.slice(0,v.v.itemsPerPage);const t=v.v.itemsPerPage,r=o.imagePairs.length,s=Math.floor(2/3*t);let n=Math.max(0,e-Math.floor(t/2)),i=n+t;return e>s&&(n=Math.min(r-t,e-Math.floor(t/2)),i=n+t),o.imagePairs.slice(n,i)}const Q={};function ir(e,t){const r=Q[e.name]??null,s=Date.now();if(!r)Q[e.name]=s;else if(s-Q[e.name]<t)return()=>{};return Q[e.name]=s,e}class Ue{constructor(t,r){p(this,"currentItemId");p(this,"skippedCount");p(this,"totalCount");p(this,"progress");p(this,"startTime");p(this,"estimatedTime");p(this,"estimatedTimeMins");p(this,"estimatedTimeSecs");p(this,"speed");p(this,"remainingItems");p(this,"updateFunction");this.currentItemId=0,this.skippedCount=0,this.progress=0,this.startTime=Date.now(),this.estimatedTime=0,this.estimatedTimeMins=0,this.estimatedTimeSecs=0,this.speed=0,this.remainingItems=0,this.totalCount=t,this.updateFunction=r??function(){}}updateCurrentItemId(t,{update:r=!1}={}){this.currentItemId=t,r&&this.updateProgress()}incrementCurrentItemId({update:t=!1}={}){this.currentItemId++,t&&this.updateProgress()}incrementSkippedCount({update:t=!1}={}){this.skippedCount++,t&&this.updateProgress()}updateProgress(){this.progress=Math.round(this.currentItemId/this.totalCount*100),this.remainingItems=this.totalCount-this.currentItemId;const t=Date.now()-this.startTime;this.speed=this.currentItemId/(t/1e3),this.estimatedTime=this.remainingItems/this.speed*1e3,this.estimatedTimeMins=Math.floor(this.estimatedTime/6e4),this.estimatedTimeSecs=Math.floor(this.estimatedTime%6e4/1e3),this.updateFunction()}}async function ar(){var n;const e=H(o.whichFolderHeic??"v1");if(typeof window==null)return;const t=(await ut(async()=>{const{default:i}=await import("./D2fYZksU.js").then(a=>a.h);return{default:i}},[],import.meta.url)).default;o.converter.startTime=Date.now();const r=new Ue(o.imagePairsHeic.length,()=>{if(r.currentItemId===r.totalCount){o.bottomBar.statusText="Conversion completed!";return}o.bottomBar.statusText=`Progress: ${r.progress}%... Converting ${r.currentItemId} of ${r.totalCount} images... Skipped: ${r.skippedCount}; (Speed: ${r.speed.toFixed(2)} images/sec, Estimated time: ${r.estimatedTimeMins}min ${r.estimatedTimeSecs}sec)`});for(const i of o.imagePairsHeic)await fetch((n=i[e])==null?void 0:n.url).then(a=>a.blob()).then(a=>t({blob:a,toType:"image/jpeg",quality:o.converter.jpegQuality})).then(async a=>{var m;const c=URL.createObjectURL(a),u=(m=i[e])==null?void 0:m.name.replace(/\.[^/.]+$/,".jpg");await fetch(c).then(d=>d.blob()).then(async d=>{var h;const b=new File([d],u,{type:"image/jpeg"});o.converter.outputDirFileSysHandle||(o.converter.outputDirFileSysHandle=await window.showDirectoryPicker());const T=await((h=o.converter.outputDirFileSysHandle)==null?void 0:h.getFileHandle(u,{create:!0})),g=await(T==null?void 0:T.createWritable());await(g==null?void 0:g.write(b)),await(g==null?void 0:g.close()),URL.revokeObjectURL(c),r.incrementCurrentItemId()}).catch(d=>{s(d)})}).catch(a=>{s(a)}),r.updateProgress();function s(i){console.log(i),r.incrementSkippedCount()}o.converter.progress=100,o.bottomBar.statusText="Conversion completed!"}async function or(e){var r;if(!o.selections.size)return;const t=new Ue(o.selections.size,()=>{if(t.currentItemId===t.totalCount){o.bottomBar.statusText="Operation completed successfully!";return}o.bottomBar.statusText=`Progress: ${t.progress}%... ${e?"Moving":"Copying"} ${t.currentItemId} of ${t.totalCount} images...(Speed: ${t.speed.toFixed(2)} images/sec, Estimated time: ${t.estimatedTimeMins}min ${t.estimatedTimeSecs}sec)`});try{const s=await window.showDirectoryPicker({mode:"readwrite"});for(const[n,i]of o.selections){const c=(r=o.imagePairs.find(u=>u.baseName===n)[i])==null?void 0:r.handle;if(c){const m=await(await s.getFileHandle(c.name,{create:!0})).createWritable(),d=await c.getFile();await m.write(d),await m.close(),e&&await c.remove(),t.incrementCurrentItemId({update:!0})}}alert("Operation completed successfully!")}catch(s){console.error("File operation failed:",s)}}async function cr(){const e=await te("SelectionData");e&&(e.forEach((t,r)=>{J(r,t,!0)}),pe())}function Ke(e,t=v.v.defaultNotificationDuration,r){W[e]=!0,console.log(e,W[e]),setTimeout(()=>{W[e]=!1,console.log(e,W[e])},t)}async function lr(){await xe("SelectionData",o.selections),Ke("Selections_saved",v.v.defaultNotificationDuration)}async function ur(){Gt("SelectionData"),o.selections.clear(),Le(v.v.defaultSelection),Ke("Selections_reset_done",v.v.defaultNotificationDuration)}const Xt={v1DirPath:"",v2DirPath:"",v1DirName:"Dir1",v2DirName:"Dir2",otherDirs:{convOut:""},defaultSelection:"v1",itemsPerPage:20,thumbnailSize:50,spacing:10,dirsOk:!1,imageFullscreenView:!0,showNameInInfoBar:!1,defaultNotificationDuration:2500},v=new jt("app-settings",Xt,{syncTabs:!1}),o=H({v1DirFileSysHandle:null,v2DirFileSysHandle:null,imagePairsAll:[],imagePairsHeic:[],imagePairs:[],v1Len:0,v2Len:0,overlaps:0,selections:new le,currentPage:1,status:{v1:0,v2:0},heicCount:0,whichFolderHeic:"v1",currentPair:null,layout:{topBar:56,bottomBar:24,bodyArea:0,svelteInnerHeight:0,largeViewImgHeight:0},currentPairID:0,bottomBar:{show:!1,statusText:"",showId:!0},converter:{inputDirFileSysHandle:null,jpegQuality:80,outputDirFileSysHandle:null,progress:0,startTime:0}}),W=H({Selections_saved:!1,Selections_reset_done:!1});function ce(e,t){if(!t){console.log("no handle to save");return}xe(e,t)}async function fr(){return{v1:await te("v1"),v2:await te("v2")}}function dr(){localStorage.clear(),Qt(),location.reload()}function mr(e){var t,r,s,n,i;switch(e){case"Space":case"KeyE":case"Numpad6":X(1);break;case"Numpad4":case"KeyArrowLeft":case"KeyQ":X(-1);break;case"Numpad1":case"KeyA":(t=o.currentPair)!=null&&t.baseName&&(J((r=o.currentPair)==null?void 0:r.baseName,"v1"),X(1));break;case"Numpad3":case"KeyD":(s=o.currentPair)!=null&&s.baseName&&(J((n=o.currentPair)==null?void 0:n.baseName,"v2"),X(1));break;case"NumpadSubtract":case"KeyX":J((i=o.currentPair)==null?void 0:i.baseName,"none");break}}function X(e){if(!o.imagePairs)return;const t=o.imagePairs.indexOf(o.currentPair);t<o.imagePairs.length-e?o.currentPair=o.imagePairs[t+e]:console.log("No more pairs to show")}function gr(e){var t,r,s;o.bottomBar.statusText=e.target.getAttribute("data-infobar")??((t=e.target.parentNode)==null?void 0:t.getAttribute("data-infobar"))??((s=(r=e.target.parentNode)==null?void 0:r.parentElement)==null?void 0:s.getAttribute("data-infobar"))??""}export{o as A,ar as E,v as a,dr as b,be as c,Le as d,Wt as e,nr as f,fr as g,mr as h,J as i,lr as j,ur as k,cr as l,gr as m,or as n,W as o,sr as p,tr as r,rr as s,ir as t};
