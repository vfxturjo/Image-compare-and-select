var Ze=Object.defineProperty;var Je=Object.getPrototypeOf;var et=Reflect.get;var Ie=e=>{throw TypeError(e)};var tt=(e,t,r)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var g=(e,t,r)=>tt(e,typeof t!="symbol"?t+"":t,r),oe=(e,t,r)=>t.has(e)||Ie("Cannot "+r);var u=(e,t,r)=>(oe(e,t,"read from private field"),r?r.call(e):t.get(e)),y=(e,t,r)=>t.has(e)?Ie("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),x=(e,t,r,s)=>(oe(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),A=(e,t,r)=>(oe(e,t,"access private method"),r);var Se=(e,t,r)=>et(Je(e),r,t);import{T as rt,aC as Ne,ay as st,h as re,aJ as nt,aK as it,aL as at,Z as _,aM as ot,k as w,b as ct,u as lt,aE as ut,R as F,aF as ke,aN as ft,ak as dt}from"./D-uJMW2w.js";import{j as mt,o as ht}from"./CzixSj1C.js";import{p as k,_ as gt}from"./CSiciwox.js";const pt=[];function yt(e,t=!1){return Z(e,new Map,"",pt)}function Z(e,t,r,s,n=null){if(typeof e=="object"&&e!==null){var i=t.get(e);if(i!==void 0)return i;if(e instanceof Map)return new Map(e);if(e instanceof Set)return new Set(e);if(rt(e)){var a=Array(e.length);t.set(e,a),n!==null&&t.set(n,a);for(var c=0;c<e.length;c+=1){var l=e[c];c in e&&(a[c]=Z(l,t,r,s))}return a}if(Ne(e)===st){a={},t.set(e,a),n!==null&&t.set(n,a);for(var d in e)a[d]=Z(e[d],t,r,s);return a}if(e instanceof Date)return structuredClone(e);if(typeof e.toJSON=="function")return Z(e.toJSON(),t,r,s,e)}if(e instanceof EventTarget)return e;try{return structuredClone(e)}catch{return e}}function ur(e){if(re){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;be(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var n=e.checked;be(e,"checked",null),e.checked=n}}};e.__on_r=r,it(r),mt()}}function be(e,t,r,s){var n=e.__attributes??(e.__attributes={});re&&(n[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||n[t]!==(n[t]=r)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[at]=r),r==null?e.removeAttribute(t):typeof r!="string"&&wt(e).includes(t)?e[t]=r:e.setAttribute(t,r))}var Pe=new Map;function wt(e){var t=Pe.get(e.nodeName);if(t)return t;Pe.set(e.nodeName,t=[]);for(var r,s=e,n=Element.prototype;n!==s;){r=nt(s);for(var i in r)r[i].set&&t.push(i);s=Ne(s)}return t}function fr(e,t,r){var s=e.__className,n=vt(t);re&&e.className===n?e.__className=n:(s!==n||re&&e.className!==n)&&(t==null?e.removeAttribute("class"):e.className=n,e.__className=n)}function vt(e,t){return(e??"")+""}function C(e){_(e,e.v+1)}function It(e){let t=0,r=F(0),s;return()=>{ot()&&(w(r),ct(()=>(t===0&&(s=lt(()=>e(()=>C(r)))),t+=1,()=>{ut().then(()=>{t-=1,t===0&&(s==null||s(),s=void 0)})})))}}var b,P,T,M,J;const ve=class ve extends Map{constructor(r){super();y(this,M);y(this,b,new Map);y(this,P,F(0));y(this,T,F(0));if(r){for(var[s,n]of r)super.set(s,n);u(this,T).v=super.size}}has(r){var s=u(this,b),n=s.get(r);if(n===void 0){var i=super.get(r);if(i!==void 0)n=F(0),s.set(r,n);else return w(u(this,P)),!1}return w(n),!0}forEach(r,s){A(this,M,J).call(this),super.forEach(r,s)}get(r){var s=u(this,b),n=s.get(r);if(n===void 0){var i=super.get(r);if(i!==void 0)n=F(0),s.set(r,n);else{w(u(this,P));return}}return w(n),super.get(r)}set(r,s){var I;var n=u(this,b),i=n.get(r),a=super.get(r),c=super.set(r,s),l=u(this,P);if(i===void 0)n.set(r,F(0)),_(u(this,T),super.size),C(l);else if(a!==s){C(i);var d=l.reactions===null?null:new Set(l.reactions),m=d===null||!((I=i.reactions)!=null&&I.every(E=>d.has(E)));m&&C(l)}return c}delete(r){var s=u(this,b),n=s.get(r),i=super.delete(r);return n!==void 0&&(s.delete(r),_(u(this,T),super.size),_(n,-1),C(u(this,P))),i}clear(){if(super.size!==0){super.clear();var r=u(this,b);_(u(this,T),0);for(var s of r.values())_(s,-1);C(u(this,P)),r.clear()}}keys(){return w(u(this,P)),super.keys()}values(){return A(this,M,J).call(this),super.values()}entries(){return A(this,M,J).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return w(u(this,T)),super.size}};b=new WeakMap,P=new WeakMap,T=new WeakMap,M=new WeakSet,J=function(){w(u(this,P));var r=u(this,b);if(u(this,T).v!==r.size)for(var s of Se(ve.prototype,this,"keys").call(this))r.has(s)||r.set(s,F(0));for(var[,n]of u(this,b))w(n)};let fe=ve;class St{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(t,r){this.keyToValue.set(t,r),this.valueToKey.set(r,t)}getByKey(t){return this.keyToValue.get(t)}getByValue(t){return this.valueToKey.get(t)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class Oe{constructor(t){this.generateIdentifier=t,this.kv=new St}register(t,r){this.kv.getByValue(t)||(r||(r=this.generateIdentifier(t)),this.kv.set(r,t))}clear(){this.kv.clear()}getIdentifier(t){return this.kv.getByValue(t)}getValue(t){return this.kv.getByKey(t)}}class bt extends Oe{constructor(){super(t=>t.name),this.classToAllowedProps=new Map}register(t,r){typeof r=="object"?(r.allowProps&&this.classToAllowedProps.set(t,r.allowProps),super.register(t,r.identifier)):super.register(t,r)}getAllowedProps(t){return this.classToAllowedProps.get(t)}}function Pt(e){if("values"in Object)return Object.values(e);const t=[];for(const r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function Tt(e,t){const r=Pt(e);if("find"in r)return r.find(t);const s=r;for(let n=0;n<s.length;n++){const i=s[n];if(t(i))return i}}function $(e,t){Object.entries(e).forEach(([r,s])=>t(s,r))}function ee(e,t){return e.indexOf(t)!==-1}function Te(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(t(s))return s}}class _t{constructor(){this.transfomers={}}register(t){this.transfomers[t.name]=t}findApplicable(t){return Tt(this.transfomers,r=>r.isApplicable(t))}findByName(t){return this.transfomers[t]}}const Et=e=>Object.prototype.toString.call(e).slice(8,-1),Re=e=>typeof e>"u",At=e=>e===null,L=e=>typeof e!="object"||e===null||e===Object.prototype?!1:Object.getPrototypeOf(e)===null?!0:Object.getPrototypeOf(e)===Object.prototype,de=e=>L(e)&&Object.keys(e).length===0,O=e=>Array.isArray(e),Dt=e=>typeof e=="string",Nt=e=>typeof e=="number"&&!isNaN(e),kt=e=>typeof e=="boolean",Ot=e=>e instanceof RegExp,U=e=>e instanceof Map,j=e=>e instanceof Set,Fe=e=>Et(e)==="Symbol",Rt=e=>e instanceof Date&&!isNaN(e.valueOf()),Ft=e=>e instanceof Error,_e=e=>typeof e=="number"&&isNaN(e),Ct=e=>kt(e)||At(e)||Re(e)||Nt(e)||Dt(e)||Fe(e),Ht=e=>typeof e=="bigint",Mt=e=>e===1/0||e===-1/0,Vt=e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),zt=e=>e instanceof URL,Ce=e=>e.replace(/\./g,"\\."),ce=e=>e.map(String).map(Ce).join("."),K=e=>{const t=[];let r="";for(let n=0;n<e.length;n++){let i=e.charAt(n);if(i==="\\"&&e.charAt(n+1)==="."){r+=".",n++;continue}if(i==="."){t.push(r),r="";continue}r+=i}const s=r;return t.push(s),t};function S(e,t,r,s){return{isApplicable:e,annotation:t,transform:r,untransform:s}}const He=[S(Re,"undefined",()=>null,()=>{}),S(Ht,"bigint",e=>e.toString(),e=>typeof BigInt<"u"?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),S(Rt,"Date",e=>e.toISOString(),e=>new Date(e)),S(Ft,"Error",(e,t)=>{const r={name:e.name,message:e.message};return t.allowedErrorProps.forEach(s=>{r[s]=e[s]}),r},(e,t)=>{const r=new Error(e.message);return r.name=e.name,r.stack=e.stack,t.allowedErrorProps.forEach(s=>{r[s]=e[s]}),r}),S(Ot,"regexp",e=>""+e,e=>{const t=e.slice(1,e.lastIndexOf("/")),r=e.slice(e.lastIndexOf("/")+1);return new RegExp(t,r)}),S(j,"set",e=>[...e.values()],e=>new Set(e)),S(U,"map",e=>[...e.entries()],e=>new Map(e)),S(e=>_e(e)||Mt(e),"number",e=>_e(e)?"NaN":e>0?"Infinity":"-Infinity",Number),S(e=>e===0&&1/e===-1/0,"number",()=>"-0",Number),S(zt,"URL",e=>e.toString(),e=>new URL(e))];function ie(e,t,r,s){return{isApplicable:e,annotation:t,transform:r,untransform:s}}const Me=ie((e,t)=>Fe(e)?!!t.symbolRegistry.getIdentifier(e):!1,(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,r)=>{const s=r.symbolRegistry.getValue(t[1]);if(!s)throw new Error("Trying to deserialize unknown symbol");return s}),$t=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),Ve=ie(Vt,e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{const r=$t[t[1]];if(!r)throw new Error("Trying to deserialize unknown typed array");return new r(e)});function ze(e,t){return e!=null&&e.constructor?!!t.classRegistry.getIdentifier(e.constructor):!1}const $e=ie(ze,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{const r=t.classRegistry.getAllowedProps(e.constructor);if(!r)return{...e};const s={};return r.forEach(n=>{s[n]=e[n]}),s},(e,t,r)=>{const s=r.classRegistry.getValue(t[1]);if(!s)throw new Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(s.prototype),e)}),Be=ie((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,r)=>{const s=r.customTransformerRegistry.findByName(t[1]);if(!s)throw new Error("Trying to deserialize unknown custom value");return s.deserialize(e)}),Bt=[$e,Me,Be,Ve],Ee=(e,t)=>{const r=Te(Bt,n=>n.isApplicable(e,t));if(r)return{value:r.transform(e,t),type:r.annotation(e,t)};const s=Te(He,n=>n.isApplicable(e,t));if(s)return{value:s.transform(e,t),type:s.annotation}},xe={};He.forEach(e=>{xe[e.annotation]=e});const xt=(e,t,r)=>{if(O(t))switch(t[0]){case"symbol":return Me.untransform(e,t,r);case"class":return $e.untransform(e,t,r);case"custom":return Be.untransform(e,t,r);case"typed-array":return Ve.untransform(e,t,r);default:throw new Error("Unknown transformation: "+t)}else{const s=xe[t];if(!s)throw new Error("Unknown transformation: "+t);return s.untransform(e,r)}},H=(e,t)=>{if(t>e.size)throw new Error("index out of bounds");const r=e.keys();for(;t>0;)r.next(),t--;return r.next().value};function Ke(e){if(ee(e,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(ee(e,"prototype"))throw new Error("prototype is not allowed as a property");if(ee(e,"constructor"))throw new Error("constructor is not allowed as a property")}const Kt=(e,t)=>{Ke(t);for(let r=0;r<t.length;r++){const s=t[r];if(j(e))e=H(e,+s);else if(U(e)){const n=+s,i=+t[++r]==0?"key":"value",a=H(e,n);switch(i){case"key":e=a;break;case"value":e=e.get(a);break}}else e=e[s]}return e},me=(e,t,r)=>{if(Ke(t),t.length===0)return r(e);let s=e;for(let i=0;i<t.length-1;i++){const a=t[i];if(O(s)){const c=+a;s=s[c]}else if(L(s))s=s[a];else if(j(s)){const c=+a;s=H(s,c)}else if(U(s)){if(i===t.length-2)break;const l=+a,d=+t[++i]==0?"key":"value",m=H(s,l);switch(d){case"key":s=m;break;case"value":s=s.get(m);break}}}const n=t[t.length-1];if(O(s)?s[+n]=r(s[+n]):L(s)&&(s[n]=r(s[n])),j(s)){const i=H(s,+n),a=r(i);i!==a&&(s.delete(i),s.add(a))}if(U(s)){const i=+t[t.length-2],a=H(s,i);switch(+n==0?"key":"value"){case"key":{const l=r(a);s.set(l,s.get(a)),l!==a&&s.delete(a);break}case"value":{s.set(a,r(s.get(a)));break}}}return e};function he(e,t,r=[]){if(!e)return;if(!O(e)){$(e,(i,a)=>he(i,t,[...r,...K(a)]));return}const[s,n]=e;n&&$(n,(i,a)=>{he(i,t,[...r,...K(a)])}),t(s,r)}function Lt(e,t,r){return he(t,(s,n)=>{e=me(e,n,i=>xt(i,s,r))}),e}function Ut(e,t){function r(s,n){const i=Kt(e,K(n));s.map(K).forEach(a=>{e=me(e,a,()=>i)})}if(O(t)){const[s,n]=t;s.forEach(i=>{e=me(e,K(i),()=>e)}),n&&$(n,r)}else $(t,r);return e}const jt=(e,t)=>L(e)||O(e)||U(e)||j(e)||ze(e,t);function qt(e,t,r){const s=r.get(e);s?s.push(t):r.set(e,[t])}function Gt(e,t){const r={};let s;return e.forEach(n=>{if(n.length<=1)return;t||(n=n.map(c=>c.map(String)).sort((c,l)=>c.length-l.length));const[i,...a]=n;i.length===0?s=a.map(ce):r[ce(i)]=a.map(ce)}),s?de(r)?[s]:[s,r]:de(r)?void 0:r}const Le=(e,t,r,s,n=[],i=[],a=new Map)=>{const c=Ct(e);if(!c){qt(e,n,t);const h=a.get(e);if(h)return s?{transformedValue:null}:h}if(!jt(e,r)){const h=Ee(e,r),p=h?{transformedValue:h.value,annotations:[h.type]}:{transformedValue:e};return c||a.set(e,p),p}if(ee(i,e))return{transformedValue:null};const l=Ee(e,r),d=(l==null?void 0:l.value)??e,m=O(d)?[]:{},I={};$(d,(h,p)=>{if(p==="__proto__"||p==="constructor"||p==="prototype")throw new Error(`Detected property ${p}. This is a prototype pollution risk, please remove it from your object.`);const B=Le(h,t,r,s,[...n,p],[...i,e],a);m[p]=B.transformedValue,O(B.annotations)?I[p]=B.annotations:L(B.annotations)&&$(B.annotations,(Xe,Ye)=>{I[Ce(p)+"."+Ye]=Xe})});const E=de(I)?{transformedValue:m,annotations:l?[l.type]:void 0}:{transformedValue:m,annotations:l?[l.type,I]:I};return c||a.set(e,E),E};function Ue(e){return Object.prototype.toString.call(e).slice(8,-1)}function Ae(e){return Ue(e)==="Array"}function Qt(e){if(Ue(e)!=="Object")return!1;const t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}function Wt(e,t,r,s,n){const i={}.propertyIsEnumerable.call(s,t)?"enumerable":"nonenumerable";i==="enumerable"&&(e[t]=r),n&&i==="nonenumerable"&&Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0,configurable:!0})}function ge(e,t={}){if(Ae(e))return e.map(n=>ge(n,t));if(!Qt(e))return e;const r=Object.getOwnPropertyNames(e),s=Object.getOwnPropertySymbols(e);return[...r,...s].reduce((n,i)=>{if(Ae(t.props)&&!t.props.includes(i))return n;const a=e[i],c=ge(a,t);return Wt(n,i,c,e,t.nonenumerable),n},{})}class f{constructor({dedupe:t=!1}={}){this.classRegistry=new bt,this.symbolRegistry=new Oe(r=>r.description??""),this.customTransformerRegistry=new _t,this.allowedErrorProps=[],this.dedupe=t}serialize(t){const r=new Map,s=Le(t,r,this,this.dedupe),n={json:s.transformedValue};s.annotations&&(n.meta={...n.meta,values:s.annotations});const i=Gt(r,this.dedupe);return i&&(n.meta={...n.meta,referentialEqualities:i}),n}deserialize(t){const{json:r,meta:s}=t;let n=ge(r);return s!=null&&s.values&&(n=Lt(n,s.values,this)),s!=null&&s.referentialEqualities&&(n=Ut(n,s.referentialEqualities)),n}stringify(t){return JSON.stringify(this.serialize(t))}parse(t){return this.deserialize(JSON.parse(t))}registerClass(t,r){this.classRegistry.register(t,r)}registerSymbol(t,r){this.symbolRegistry.register(t,r)}registerCustom(t,r){this.customTransformerRegistry.register({name:r,...t})}allowErrorProps(...t){this.allowedErrorProps.push(...t)}}f.defaultInstance=new f;f.serialize=f.defaultInstance.serialize.bind(f.defaultInstance);f.deserialize=f.defaultInstance.deserialize.bind(f.defaultInstance);f.stringify=f.defaultInstance.stringify.bind(f.defaultInstance);f.parse=f.defaultInstance.parse.bind(f.defaultInstance);f.registerClass=f.defaultInstance.registerClass.bind(f.defaultInstance);f.registerSymbol=f.defaultInstance.registerSymbol.bind(f.defaultInstance);f.registerCustom=f.defaultInstance.registerCustom.bind(f.defaultInstance);f.allowErrorProps=f.defaultInstance.allowErrorProps.bind(f.defaultInstance);const Xt=window;function Yt(e,t){switch(e){case"local":return t.localStorage;case"session":return t.sessionStorage}}var D,N,V,z,q,ne,R,pe,ye;class je{constructor(t,r,s={}){y(this,R);y(this,D,ke());y(this,N);y(this,V);y(this,z);y(this,q);y(this,ne,t=>{t.key!==u(this,N)||t.newValue===null||A(this,R,pe).call(this,t.newValue)});const{storage:n="local",serializer:i={serialize:f.stringify,deserialize:f.parse},syncTabs:a=!0,window:c=Xt}=s;if(u(this,D).v=k(r),x(this,N,t),x(this,V,i),c===void 0)return;const l=Yt(n,c);x(this,z,l);const d=l.getItem(t);d!==null&&A(this,R,pe).call(this,d),a&&n==="local"&&x(this,q,It(()=>ht(c,"storage",u(this,ne)))),ft(()=>{dt(()=>{var m;(m=u(this,q))==null||m.call(this),A(this,R,ye).call(this,w(u(this,D)))})})}get v(){return w(u(this,D))}set v(t){_(u(this,D),k(t)),A(this,R,ye).call(this,t)}}D=new WeakMap,N=new WeakMap,V=new WeakMap,z=new WeakMap,q=new WeakMap,ne=new WeakMap,R=new WeakSet,pe=function(t){try{_(u(this,D),k(u(this,V).deserialize(t)))}catch(r){console.error(`Error when parsing "${t}" from persisted store "${u(this,N)}"`,r)}},ye=function(t){var r;try{(r=u(this,z))==null||r.setItem(u(this,N),u(this,V).serialize(t))}catch(s){console.error(`Error when writing value from persisted store "${u(this,N)}" to ${u(this,z)}`,s)}};function Q(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function Zt(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=Q(r);return(n,i)=>s.then(a=>i(a.transaction(t,n).objectStore(t)))}let le;function ae(){return le||(le=Zt("keyval-store","keyval")),le}function se(e,t=ae()){return t("readonly",r=>Q(r.get(e)))}function qe(e,t,r=ae()){return r("readwrite",s=>(s.put(t,e),Q(s.transaction)))}function Jt(e,t=ae()){return t("readwrite",r=>(r.delete(e),Q(r.transaction)))}function er(e=ae()){return e("readwrite",t=>(t.clear(),Q(t.transaction)))}async function dr(e,t=!1,r=!1){try{let s;t?s=await se(e).then(i=>i):s=await window.showDirectoryPicker();const n=s.name;e==="v1"?(v.v.v1DirPath=n,o.v1DirFileSysHandle=s,ue("v1",s)):e==="v2"?(v.v.v2DirPath=n,o.v2DirFileSysHandle=s,ue("v2",s)):e==="convOut"&&(v.v.otherDirs.convOut=n,o.converter.outputDirFileSysHandle=s,ue("convOut",s)),tr(r)}catch{console.log("Directory picker canceled")}}async function tr(e=!1){var i;v.v.dirsOk=!1;let t=[],r=[];if(o.v1DirFileSysHandle&&(t=await De(o.v1DirFileSysHandle),o.v1Len=t.length),o.v2DirFileSysHandle&&(r=await De(o.v2DirFileSysHandle),o.v2Len=r.length),(!o.v1DirFileSysHandle||!o.v2DirFileSysHandle)&&!e)return;v.v.dirsOk=!0;const s=new Map(t.map(a=>[a.name.split(".")[0],a])),n=new Map(r.map(a=>[a.name.split(".")[0],a]));if(o.imagePairsAll=Array.from(new Set([...s.keys(),...n.keys()])).map(a=>({baseName:a,v1:s.get(a),v2:n.get(a)})),o.overlaps=o.imagePairsAll.filter(a=>a.v1&&a.v2).length,o.imagePairsAll.sort((a,c)=>a.baseName.localeCompare(c.baseName)),o.imagePairsHeic=o.imagePairsAll.filter(a=>{var c,l;return((c=a.v1)==null?void 0:c.name.match(/\.heic$/i))||((l=a.v2)==null?void 0:l.name.match(/\.heic$/i))}),o.heicCount=o.imagePairsHeic.length,o.imagePairs=o.imagePairsAll.filter(a=>{var c,l;return!((c=a.v1)!=null&&c.name.match(/\.heic$/i))&&!((l=a.v2)!=null&&l.name.match(/\.heic$/i))}),o.imagePairsHeic.length>0){const a=o.imagePairsHeic[0];o.whichFolderHeic=(i=a.v1)!=null&&i.name.match(/\.heic$/i)?"v1":"v2"}Ge(v.v.defaultSelection)}async function De(e){const t=[];for await(const r of e.values())r.kind==="file"&&r.name.match(/\.(png|jpg|jpeg|gif|webp|heic)$/i)&&t.push({handle:r,name:r.name,url:URL.createObjectURL(await r.getFile())});return t}function Ge(e){e===""&&o.selections.clear(),o.imagePairs.forEach(t=>{e==="v1"&&t.v1?o.selections.set(t.baseName,"v1"):e==="v2"&&t.v2&&o.selections.set(t.baseName,"v2")}),we()}function we(){let e=0,t=0;o.selections.forEach(r=>{r==="v1"?e++:r==="v2"&&t++}),o.status={v1:e,v2:t}}function te(e,t,r=!1){e==null||e==null||(o.selections.set(e,t),o.showTopIndicator&&ir.show({innerHTML:"<h1 class='h1'>âœ”</h1>",anchorElement:document.querySelector(`#mainImg-${t}`),timeout:1}),r||we())}function mr(){const e=o.imagePairs.findIndex(a=>{var c;return a.baseName===((c=o.currentPair)==null?void 0:c.baseName)});if(e===-1)return o.imagePairs.slice(0,v.v.itemsPerPage);const t=v.v.itemsPerPage,r=o.imagePairs.length,s=Math.floor(2/3*t);let n=Math.max(0,e-Math.floor(t/2)),i=n+t;return e>s&&(n=Math.min(r-t,e-Math.floor(t/2)),i=n+t),o.imagePairs.slice(n,i)}const W={};function hr(e,t){const r=W[e.name]??null,s=Date.now();if(!r)W[e.name]=s;else if(s-W[e.name]<t)return()=>{};return W[e.name]=s,e}class Qe{constructor(t,r){g(this,"currentItemId");g(this,"skippedCount");g(this,"totalCount");g(this,"progress");g(this,"startTime");g(this,"estimatedTime");g(this,"estimatedTimeMins");g(this,"estimatedTimeSecs");g(this,"speed");g(this,"remainingItems");g(this,"updateFunction");this.currentItemId=0,this.skippedCount=0,this.progress=0,this.startTime=Date.now(),this.estimatedTime=0,this.estimatedTimeMins=0,this.estimatedTimeSecs=0,this.speed=0,this.remainingItems=0,this.totalCount=t,this.updateFunction=r??function(){}}updateCurrentItemId(t,{update:r=!1}={}){this.currentItemId=t,r&&this.updateProgress()}incrementCurrentItemId({update:t=!1}={}){this.currentItemId++,t&&this.updateProgress()}incrementSkippedCount({update:t=!1}={}){this.skippedCount++,t&&this.updateProgress()}updateProgress(){this.progress=Math.round(this.currentItemId/this.totalCount*100),this.remainingItems=this.totalCount-this.currentItemId;const t=Date.now()-this.startTime;this.speed=this.currentItemId/(t/1e3),this.estimatedTime=this.remainingItems/this.speed*1e3,this.estimatedTimeMins=Math.floor(this.estimatedTime/6e4),this.estimatedTimeSecs=Math.floor(this.estimatedTime%6e4/1e3),this.updateFunction()}}async function gr(){var n;const e=k(o.whichFolderHeic??"v1");if(typeof window==null)return;const t=(await gt(async()=>{const{default:i}=await import("./D2fYZksU.js").then(a=>a.h);return{default:i}},[],import.meta.url)).default;o.converter.startTime=Date.now();const r=new Qe(o.imagePairsHeic.length,()=>{if(r.currentItemId===r.totalCount){o.bottomBar.statusText="Conversion completed!";return}o.bottomBar.statusText=`Progress: ${r.progress}%... Converting ${r.currentItemId} of ${r.totalCount} images... Skipped: ${r.skippedCount}; (Speed: ${r.speed.toFixed(2)} images/sec, Estimated time: ${r.estimatedTimeMins}min ${r.estimatedTimeSecs}sec)`});for(const i of o.imagePairsHeic)await fetch((n=i[e])==null?void 0:n.url).then(a=>a.blob()).then(a=>t({blob:a,toType:"image/jpeg",quality:o.converter.jpegQuality})).then(async a=>{var d;const c=URL.createObjectURL(a),l=(d=i[e])==null?void 0:d.name.replace(/\.[^/.]+$/,".jpg");await fetch(c).then(m=>m.blob()).then(async m=>{var p;const I=new File([m],l,{type:"image/jpeg"});o.converter.outputDirFileSysHandle||(o.converter.outputDirFileSysHandle=await window.showDirectoryPicker());const E=await((p=o.converter.outputDirFileSysHandle)==null?void 0:p.getFileHandle(l,{create:!0})),h=await(E==null?void 0:E.createWritable());await(h==null?void 0:h.write(I)),await(h==null?void 0:h.close()),URL.revokeObjectURL(c),r.incrementCurrentItemId()}).catch(m=>{s(m)})}).catch(a=>{s(a)}),r.updateProgress();function s(i){console.log(i),r.incrementSkippedCount()}o.converter.progress=100,o.bottomBar.statusText="Conversion completed!"}async function pr(e){var r;if(!o.selections.size)return;const t=new Qe(o.selections.size,()=>{if(t.currentItemId===t.totalCount){o.bottomBar.statusText="Operation completed successfully!";return}o.bottomBar.statusText=`Progress: ${t.progress}%... ${e?"Moving":"Copying"} ${t.currentItemId} of ${t.totalCount} images...(Speed: ${t.speed.toFixed(2)} images/sec, Estimated time: ${t.estimatedTimeMins}min ${t.estimatedTimeSecs}sec)`});try{const s=await window.showDirectoryPicker({mode:"readwrite"});for(const[n,i]of o.selections){const c=(r=o.imagePairs.find(l=>l.baseName===n)[i])==null?void 0:r.handle;if(c){const d=await(await s.getFileHandle(c.name,{create:!0})).createWritable(),m=await c.getFile();await d.write(m),await d.close(),e&&await c.remove(),t.incrementCurrentItemId({update:!0})}}alert("Operation completed successfully!")}catch(s){console.error("File operation failed:",s)}}async function yr(){const e=await se("SelectionData");e&&(e.forEach((t,r)=>{te(r,t,!0)}),we())}function We(e,t=v.v.defaultNotificationDuration,r){X[e]=!0,console.log(e,X[e]),setTimeout(()=>{X[e]=!1,console.log(e,X[e])},t)}async function wr(){await qe("SelectionData",o.selections),We("Selections_saved",v.v.defaultNotificationDuration)}async function vr(){Jt("SelectionData"),o.selections.clear(),Ge(v.v.defaultSelection),We("Selections_reset_done",v.v.defaultNotificationDuration)}const rr={v1DirPath:"",v2DirPath:"",v1DirName:"Dir1",v2DirName:"Dir2",otherDirs:{convOut:""},defaultSelection:"v1",itemsPerPage:20,thumbnailSize:50,spacing:10,dirsOk:!1,imageFullscreenView:!0,showNameInInfoBar:!1,defaultNotificationDuration:2500},v=new je("app-settings",rr,{syncTabs:!1}),sr={showLeftPair:["KeyQ","Numpad4"],showRightPair:["KeyD","Numpad6"],selectV1:["KeyA","Numpad1"],selectV2:["KeyD","Numpad3"],selectBoth:["KeyB","NumpadPlus"],selectNone:["KeyX","NumpadMinus"]},Ir=new je("Keyboard-settings",sr,{syncTabs:!0}),o=k({v1DirFileSysHandle:null,v2DirFileSysHandle:null,imagePairsAll:[],imagePairsHeic:[],imagePairs:[],v1Len:0,v2Len:0,overlaps:0,selections:new fe,currentPage:1,status:{v1:0,v2:0},heicCount:0,whichFolderHeic:"v1",currentPair:null,layout:{topBar:56,bottomBar:24,bodyArea:0,svelteInnerHeight:0,largeViewImgHeight:0},currentPairID:0,bottomBar:{show:!1,statusText:"",showId:!0},converter:{inputDirFileSysHandle:null,jpegQuality:80,outputDirFileSysHandle:null,progress:0,startTime:0},showTopIndicator:!0}),X=k({Selections_saved:!1,Selections_reset_done:!1});var G;class nr{constructor(t=this.defaultTimeout){g(this,"defaultTimeout",50);g(this,"defaultFadeDuration",100);g(this,"topIndicatorIdCounter",0);y(this,G,ke(k([])));this.defaultTimeout=t}get topIndicatorStore(){return w(u(this,G))}set topIndicatorStore(t){_(u(this,G),k(t))}show({innerHTML:t="THIS IS A TEST",anchorElement:r=null,timeout:s=this.defaultTimeout,fadeDuration:n=this.defaultFadeDuration}){const i=this.topIndicatorIdCounter++,{top:a,left:c,width:l,height:d}=r?r.getBoundingClientRect():{top:0,left:0,width:500,height:500};this.topIndicatorStore.push({id:i,innerHTML:t,timeout:s,fadeDuration:n,top:a,left:c,width:l,height:d}),console.log(yt(this.topIndicatorStore)),setTimeout(()=>{this.removeTopIndicator(i)},s)}removeTopIndicator(t){const r=this.topIndicatorStore.findIndex(s=>s.id===t);r!==-1&&this.topIndicatorStore.splice(r,1)}getTopIndicatorById(t){return this.topIndicatorStore.find(r=>r.id===t)}getTopIndicators(){return this.topIndicatorStore}getLength(){return this.topIndicatorStore.length}}G=new WeakMap;const ir=new nr;function ue(e,t){if(!t){console.log("no handle to save");return}qe(e,t)}async function Sr(){return{v1:await se("v1"),v2:await se("v2")}}function br(){localStorage.clear(),er(),location.reload()}function Pr(e){var t,r,s,n,i;switch(e){case"Space":case"KeyE":case"Numpad6":Y(1);break;case"Numpad4":case"KeyArrowLeft":case"KeyQ":Y(-1);break;case"Numpad1":case"KeyA":(t=o.currentPair)!=null&&t.baseName&&(te((r=o.currentPair)==null?void 0:r.baseName,"v1"),Y(1));break;case"Numpad3":case"KeyD":(s=o.currentPair)!=null&&s.baseName&&(te((n=o.currentPair)==null?void 0:n.baseName,"v2"),Y(1));break;case"NumpadSubtract":case"KeyX":te((i=o.currentPair)==null?void 0:i.baseName,"none");break}}function Y(e){if(!o.imagePairs)return;const t=o.imagePairs.indexOf(o.currentPair);t<o.imagePairs.length-e?o.currentPair=o.imagePairs[t+e]:console.log("No more pairs to show")}function Tr(e){var t,r,s;o.bottomBar.statusText=e.target.getAttribute("data-infobar")??((t=e.target.parentNode)==null?void 0:t.getAttribute("data-infobar"))??((s=(r=e.target.parentNode)==null?void 0:r.parentElement)==null?void 0:s.getAttribute("data-infobar"))??""}export{o as A,gr as E,Ir as K,v as a,br as b,be as c,Ge as d,tr as e,mr as f,Sr as g,Pr as h,te as i,ir as j,wr as k,yr as l,Tr as m,vr as n,pr as o,dr as p,X as q,ur as r,fr as s,hr as t,sr as u};
