var Ke=Object.getPrototypeOf;var Le=Reflect.get;var he=e=>{throw TypeError(e)};var ee=(e,t,r)=>t.has(e)||he("Cannot "+r);var c=(e,t,r)=>(ee(e,t,"read from private field"),r?r.call(e):t.get(e)),g=(e,t,r)=>t.has(e)?he("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),M=(e,t,r,s)=>(ee(e,t,"write to private field"),s?s.call(e,r):t.set(e,r),r),A=(e,t,r)=>(ee(e,t,"access private method"),r);var ye=(e,t,r)=>Le(Ke(e),r,t);import{h as Y,a2 as Ue,aJ as Ce,aK as qe,aL as je,$ as E,aM as Ge,k as y,b as We,u as Qe,aH as Ye,R,aI as Xe,aN as Ze,aq as Je}from"./DQ3YwMtn.js";import{c as et,o as tt}from"./DluPGE3u.js";import{p as G}from"./PYQdMiXA.js";function Gt(e){if(Y){var t=!1,r=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var s=e.value;pe(e,"value",null),e.value=s}if(e.hasAttribute("checked")){var n=e.checked;pe(e,"checked",null),e.checked=n}}};e.__on_r=r,Ce(r),et()}}function pe(e,t,r,s){var n=e.__attributes??(e.__attributes={});Y&&(n[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||n[t]!==(n[t]=r)&&(t==="style"&&"__styles"in e&&(e.__styles={}),t==="loading"&&(e[qe]=r),r==null?e.removeAttribute(t):typeof r!="string"&&rt(e).includes(t)?e[t]=r:e.setAttribute(t,r))}var ve=new Map;function rt(e){var t=ve.get(e.nodeName);if(t)return t;ve.set(e.nodeName,t=[]);for(var r,s=e,n=Element.prototype;n!==s;){r=je(s);for(var i in r)r[i].set&&t.push(i);s=Ue(s)}return t}function Wt(e,t,r){var s=e.__className,n=st(t);Y&&e.className===n?e.__className=n:(s!==n||Y&&e.className!==n)&&(t==null?e.removeAttribute("class"):e.className=n,e.__className=n)}function st(e,t){return(e??"")+""}function D(e){E(e,e.v+1)}function nt(e){let t=0,r=R(0),s;return()=>{Ge()&&(y(r),We(()=>(t===0&&(s=Qe(()=>e(()=>D(r)))),t+=1,()=>{Ye().then(()=>{t-=1,t===0&&(s==null||s(),s=void 0)})})))}}var v,w,b,z,W;const me=class me extends Map{constructor(r){super();g(this,z);g(this,v,new Map);g(this,w,R(0));g(this,b,R(0));if(r){for(var[s,n]of r)super.set(s,n);c(this,b).v=super.size}}has(r){var s=c(this,v),n=s.get(r);if(n===void 0){var i=super.get(r);if(i!==void 0)n=R(0),s.set(r,n);else return y(c(this,w)),!1}return y(n),!0}forEach(r,s){A(this,z,W).call(this),super.forEach(r,s)}get(r){var s=c(this,v),n=s.get(r);if(n===void 0){var i=super.get(r);if(i!==void 0)n=R(0),s.set(r,n);else{y(c(this,w));return}}return y(n),super.get(r)}set(r,s){var P;var n=c(this,v),i=n.get(r),a=super.get(r),l=super.set(r,s),u=c(this,w);if(i===void 0)n.set(r,R(0)),E(c(this,b),super.size),D(u);else if(a!==s){D(i);var d=u.reactions===null?null:new Set(u.reactions),m=d===null||!((P=i.reactions)!=null&&P.every(C=>d.has(C)));m&&D(u)}return l}delete(r){var s=c(this,v),n=s.get(r),i=super.delete(r);return n!==void 0&&(s.delete(r),E(c(this,b),super.size),E(n,-1),D(c(this,w))),i}clear(){if(super.size!==0){super.clear();var r=c(this,v);E(c(this,b),0);for(var s of r.values())E(s,-1);D(c(this,w)),r.clear()}}keys(){return y(c(this,w)),super.keys()}values(){return A(this,z,W).call(this),super.values()}entries(){return A(this,z,W).call(this),super.entries()}[Symbol.iterator](){return this.entries()}get size(){return y(c(this,b)),super.size}};v=new WeakMap,w=new WeakMap,b=new WeakMap,z=new WeakSet,W=function(){y(c(this,w));var r=c(this,v);if(c(this,b).v!==r.size)for(var s of ye(me.prototype,this,"keys").call(this))r.has(s)||r.set(s,R(0));for(var[,n]of c(this,v))y(n)};let ie=me;class it{constructor(){this.keyToValue=new Map,this.valueToKey=new Map}set(t,r){this.keyToValue.set(t,r),this.valueToKey.set(r,t)}getByKey(t){return this.keyToValue.get(t)}getByValue(t){return this.valueToKey.get(t)}clear(){this.keyToValue.clear(),this.valueToKey.clear()}}class Ee{constructor(t){this.generateIdentifier=t,this.kv=new it}register(t,r){this.kv.getByValue(t)||(r||(r=this.generateIdentifier(t)),this.kv.set(r,t))}clear(){this.kv.clear()}getIdentifier(t){return this.kv.getByValue(t)}getValue(t){return this.kv.getByKey(t)}}class at extends Ee{constructor(){super(t=>t.name),this.classToAllowedProps=new Map}register(t,r){typeof r=="object"?(r.allowProps&&this.classToAllowedProps.set(t,r.allowProps),super.register(t,r.identifier)):super.register(t,r)}getAllowedProps(t){return this.classToAllowedProps.get(t)}}function ot(e){if("values"in Object)return Object.values(e);const t=[];for(const r in e)e.hasOwnProperty(r)&&t.push(e[r]);return t}function lt(e,t){const r=ot(e);if("find"in r)return r.find(t);const s=r;for(let n=0;n<s.length;n++){const i=s[n];if(t(i))return i}}function H(e,t){Object.entries(e).forEach(([r,s])=>t(s,r))}function Q(e,t){return e.indexOf(t)!==-1}function we(e,t){for(let r=0;r<e.length;r++){const s=e[r];if(t(s))return s}}class ct{constructor(){this.transfomers={}}register(t){this.transfomers[t.name]=t}findApplicable(t){return lt(this.transfomers,r=>r.isApplicable(t))}findByName(t){return this.transfomers[t]}}const ut=e=>Object.prototype.toString.call(e).slice(8,-1),Ie=e=>typeof e>"u",ft=e=>e===null,x=e=>typeof e!="object"||e===null||e===Object.prototype?!1:Object.getPrototypeOf(e)===null?!0:Object.getPrototypeOf(e)===Object.prototype,ae=e=>x(e)&&Object.keys(e).length===0,N=e=>Array.isArray(e),dt=e=>typeof e=="string",gt=e=>typeof e=="number"&&!isNaN(e),mt=e=>typeof e=="boolean",ht=e=>e instanceof RegExp,K=e=>e instanceof Map,L=e=>e instanceof Set,_e=e=>ut(e)==="Symbol",yt=e=>e instanceof Date&&!isNaN(e.valueOf()),pt=e=>e instanceof Error,be=e=>typeof e=="number"&&isNaN(e),vt=e=>mt(e)||ft(e)||Ie(e)||gt(e)||dt(e)||_e(e),wt=e=>typeof e=="bigint",bt=e=>e===1/0||e===-1/0,Pt=e=>ArrayBuffer.isView(e)&&!(e instanceof DataView),St=e=>e instanceof URL,ke=e=>e.replace(/\./g,"\\."),te=e=>e.map(String).map(ke).join("."),$=e=>{const t=[];let r="";for(let n=0;n<e.length;n++){let i=e.charAt(n);if(i==="\\"&&e.charAt(n+1)==="."){r+=".",n++;continue}if(i==="."){t.push(r),r="";continue}r+=i}const s=r;return t.push(s),t};function p(e,t,r,s){return{isApplicable:e,annotation:t,transform:r,untransform:s}}const Ne=[p(Ie,"undefined",()=>null,()=>{}),p(wt,"bigint",e=>e.toString(),e=>typeof BigInt<"u"?BigInt(e):(console.error("Please add a BigInt polyfill."),e)),p(yt,"Date",e=>e.toISOString(),e=>new Date(e)),p(pt,"Error",(e,t)=>{const r={name:e.name,message:e.message};return t.allowedErrorProps.forEach(s=>{r[s]=e[s]}),r},(e,t)=>{const r=new Error(e.message);return r.name=e.name,r.stack=e.stack,t.allowedErrorProps.forEach(s=>{r[s]=e[s]}),r}),p(ht,"regexp",e=>""+e,e=>{const t=e.slice(1,e.lastIndexOf("/")),r=e.slice(e.lastIndexOf("/")+1);return new RegExp(t,r)}),p(L,"set",e=>[...e.values()],e=>new Set(e)),p(K,"map",e=>[...e.entries()],e=>new Map(e)),p(e=>be(e)||bt(e),"number",e=>be(e)?"NaN":e>0?"Infinity":"-Infinity",Number),p(e=>e===0&&1/e===-1/0,"number",()=>"-0",Number),p(St,"URL",e=>e.toString(),e=>new URL(e))];function Z(e,t,r,s){return{isApplicable:e,annotation:t,transform:r,untransform:s}}const Oe=Z((e,t)=>_e(e)?!!t.symbolRegistry.getIdentifier(e):!1,(e,t)=>["symbol",t.symbolRegistry.getIdentifier(e)],e=>e.description,(e,t,r)=>{const s=r.symbolRegistry.getValue(t[1]);if(!s)throw new Error("Trying to deserialize unknown symbol");return s}),At=[Int8Array,Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array,Uint8ClampedArray].reduce((e,t)=>(e[t.name]=t,e),{}),Re=Z(Pt,e=>["typed-array",e.constructor.name],e=>[...e],(e,t)=>{const r=At[t[1]];if(!r)throw new Error("Trying to deserialize unknown typed array");return new r(e)});function De(e,t){return e!=null&&e.constructor?!!t.classRegistry.getIdentifier(e.constructor):!1}const Te=Z(De,(e,t)=>["class",t.classRegistry.getIdentifier(e.constructor)],(e,t)=>{const r=t.classRegistry.getAllowedProps(e.constructor);if(!r)return{...e};const s={};return r.forEach(n=>{s[n]=e[n]}),s},(e,t,r)=>{const s=r.classRegistry.getValue(t[1]);if(!s)throw new Error(`Trying to deserialize unknown class '${t[1]}' - check https://github.com/blitz-js/superjson/issues/116#issuecomment-773996564`);return Object.assign(Object.create(s.prototype),e)}),ze=Z((e,t)=>!!t.customTransformerRegistry.findApplicable(e),(e,t)=>["custom",t.customTransformerRegistry.findApplicable(e).name],(e,t)=>t.customTransformerRegistry.findApplicable(e).serialize(e),(e,t,r)=>{const s=r.customTransformerRegistry.findByName(t[1]);if(!s)throw new Error("Trying to deserialize unknown custom value");return s.deserialize(e)}),Et=[Te,Oe,ze,Re],Pe=(e,t)=>{const r=we(Et,n=>n.isApplicable(e,t));if(r)return{value:r.transform(e,t),type:r.annotation(e,t)};const s=we(Ne,n=>n.isApplicable(e,t));if(s)return{value:s.transform(e,t),type:s.annotation}},Fe={};Ne.forEach(e=>{Fe[e.annotation]=e});const It=(e,t,r)=>{if(N(t))switch(t[0]){case"symbol":return Oe.untransform(e,t,r);case"class":return Te.untransform(e,t,r);case"custom":return ze.untransform(e,t,r);case"typed-array":return Re.untransform(e,t,r);default:throw new Error("Unknown transformation: "+t)}else{const s=Fe[t];if(!s)throw new Error("Unknown transformation: "+t);return s.untransform(e,r)}},T=(e,t)=>{if(t>e.size)throw new Error("index out of bounds");const r=e.keys();for(;t>0;)r.next(),t--;return r.next().value};function Ve(e){if(Q(e,"__proto__"))throw new Error("__proto__ is not allowed as a property");if(Q(e,"prototype"))throw new Error("prototype is not allowed as a property");if(Q(e,"constructor"))throw new Error("constructor is not allowed as a property")}const _t=(e,t)=>{Ve(t);for(let r=0;r<t.length;r++){const s=t[r];if(L(e))e=T(e,+s);else if(K(e)){const n=+s,i=+t[++r]==0?"key":"value",a=T(e,n);switch(i){case"key":e=a;break;case"value":e=e.get(a);break}}else e=e[s]}return e},oe=(e,t,r)=>{if(Ve(t),t.length===0)return r(e);let s=e;for(let i=0;i<t.length-1;i++){const a=t[i];if(N(s)){const l=+a;s=s[l]}else if(x(s))s=s[a];else if(L(s)){const l=+a;s=T(s,l)}else if(K(s)){if(i===t.length-2)break;const u=+a,d=+t[++i]==0?"key":"value",m=T(s,u);switch(d){case"key":s=m;break;case"value":s=s.get(m);break}}}const n=t[t.length-1];if(N(s)?s[+n]=r(s[+n]):x(s)&&(s[n]=r(s[n])),L(s)){const i=T(s,+n),a=r(i);i!==a&&(s.delete(i),s.add(a))}if(K(s)){const i=+t[t.length-2],a=T(s,i);switch(+n==0?"key":"value"){case"key":{const u=r(a);s.set(u,s.get(a)),u!==a&&s.delete(a);break}case"value":{s.set(a,r(s.get(a)));break}}}return e};function le(e,t,r=[]){if(!e)return;if(!N(e)){H(e,(i,a)=>le(i,t,[...r,...$(a)]));return}const[s,n]=e;n&&H(n,(i,a)=>{le(i,t,[...r,...$(a)])}),t(s,r)}function kt(e,t,r){return le(t,(s,n)=>{e=oe(e,n,i=>It(i,s,r))}),e}function Nt(e,t){function r(s,n){const i=_t(e,$(n));s.map($).forEach(a=>{e=oe(e,a,()=>i)})}if(N(t)){const[s,n]=t;s.forEach(i=>{e=oe(e,$(i),()=>e)}),n&&H(n,r)}else H(t,r);return e}const Ot=(e,t)=>x(e)||N(e)||K(e)||L(e)||De(e,t);function Rt(e,t,r){const s=r.get(e);s?s.push(t):r.set(e,[t])}function Dt(e,t){const r={};let s;return e.forEach(n=>{if(n.length<=1)return;t||(n=n.map(l=>l.map(String)).sort((l,u)=>l.length-u.length));const[i,...a]=n;i.length===0?s=a.map(te):r[te(i)]=a.map(te)}),s?ae(r)?[s]:[s,r]:ae(r)?void 0:r}const He=(e,t,r,s,n=[],i=[],a=new Map)=>{const l=vt(e);if(!l){Rt(e,n,t);const S=a.get(e);if(S)return s?{transformedValue:null}:S}if(!Ot(e,r)){const S=Pe(e,r),h=S?{transformedValue:S.value,annotations:[S.type]}:{transformedValue:e};return l||a.set(e,h),h}if(Q(i,e))return{transformedValue:null};const u=Pe(e,r),d=(u==null?void 0:u.value)??e,m=N(d)?[]:{},P={};H(d,(S,h)=>{if(h==="__proto__"||h==="constructor"||h==="prototype")throw new Error(`Detected property ${h}. This is a prototype pollution risk, please remove it from your object.`);const B=He(S,t,r,s,[...n,h],[...i,e],a);m[h]=B.transformedValue,N(B.annotations)?P[h]=B.annotations:x(B.annotations)&&H(B.annotations,($e,xe)=>{P[ke(h)+"."+xe]=$e})});const C=ae(P)?{transformedValue:m,annotations:u?[u.type]:void 0}:{transformedValue:m,annotations:u?[u.type,P]:P};return l||a.set(e,C),C};function Be(e){return Object.prototype.toString.call(e).slice(8,-1)}function Se(e){return Be(e)==="Array"}function Tt(e){if(Be(e)!=="Object")return!1;const t=Object.getPrototypeOf(e);return!!t&&t.constructor===Object&&t===Object.prototype}function zt(e,t,r,s,n){const i={}.propertyIsEnumerable.call(s,t)?"enumerable":"nonenumerable";i==="enumerable"&&(e[t]=r),n&&i==="nonenumerable"&&Object.defineProperty(e,t,{value:r,enumerable:!1,writable:!0,configurable:!0})}function ce(e,t={}){if(Se(e))return e.map(n=>ce(n,t));if(!Tt(e))return e;const r=Object.getOwnPropertyNames(e),s=Object.getOwnPropertySymbols(e);return[...r,...s].reduce((n,i)=>{if(Se(t.props)&&!t.props.includes(i))return n;const a=e[i],l=ce(a,t);return zt(n,i,l,e,t.nonenumerable),n},{})}class f{constructor({dedupe:t=!1}={}){this.classRegistry=new at,this.symbolRegistry=new Ee(r=>r.description??""),this.customTransformerRegistry=new ct,this.allowedErrorProps=[],this.dedupe=t}serialize(t){const r=new Map,s=He(t,r,this,this.dedupe),n={json:s.transformedValue};s.annotations&&(n.meta={...n.meta,values:s.annotations});const i=Dt(r,this.dedupe);return i&&(n.meta={...n.meta,referentialEqualities:i}),n}deserialize(t){const{json:r,meta:s}=t;let n=ce(r);return s!=null&&s.values&&(n=kt(n,s.values,this)),s!=null&&s.referentialEqualities&&(n=Nt(n,s.referentialEqualities)),n}stringify(t){return JSON.stringify(this.serialize(t))}parse(t){return this.deserialize(JSON.parse(t))}registerClass(t,r){this.classRegistry.register(t,r)}registerSymbol(t,r){this.symbolRegistry.register(t,r)}registerCustom(t,r){this.customTransformerRegistry.register({name:r,...t})}allowErrorProps(...t){this.allowedErrorProps.push(...t)}}f.defaultInstance=new f;f.serialize=f.defaultInstance.serialize.bind(f.defaultInstance);f.deserialize=f.defaultInstance.deserialize.bind(f.defaultInstance);f.stringify=f.defaultInstance.stringify.bind(f.defaultInstance);f.parse=f.defaultInstance.parse.bind(f.defaultInstance);f.registerClass=f.defaultInstance.registerClass.bind(f.defaultInstance);f.registerSymbol=f.defaultInstance.registerSymbol.bind(f.defaultInstance);f.registerCustom=f.defaultInstance.registerCustom.bind(f.defaultInstance);f.allowErrorProps=f.defaultInstance.allowErrorProps.bind(f.defaultInstance);const Ft=window;function Vt(e,t){switch(e){case"local":return t.localStorage;case"session":return t.sessionStorage}}var I,_,F,V,U,X,O,ue,fe;class Ht{constructor(t,r,s={}){g(this,O);g(this,I,Xe());g(this,_);g(this,F);g(this,V);g(this,U);g(this,X,t=>{t.key!==c(this,_)||t.newValue===null||A(this,O,ue).call(this,t.newValue)});const{storage:n="local",serializer:i={serialize:f.stringify,deserialize:f.parse},syncTabs:a=!0,window:l=Ft}=s;if(c(this,I).v=G(r),M(this,_,t),M(this,F,i),l===void 0)return;const u=Vt(n,l);M(this,V,u);const d=u.getItem(t);d!==null&&A(this,O,ue).call(this,d),a&&n==="local"&&M(this,U,nt(()=>tt(l,"storage",c(this,X)))),Ze(()=>{Je(()=>{var m;(m=c(this,U))==null||m.call(this),A(this,O,fe).call(this,y(c(this,I)))})})}get v(){return y(c(this,I))}set v(t){E(c(this,I),G(t)),A(this,O,fe).call(this,t)}}I=new WeakMap,_=new WeakMap,F=new WeakMap,V=new WeakMap,U=new WeakMap,X=new WeakMap,O=new WeakSet,ue=function(t){try{E(c(this,I),G(c(this,F).deserialize(t)))}catch(r){console.error(`Error when parsing "${t}" from persisted store "${c(this,_)}"`,r)}},fe=function(t){var r;try{(r=c(this,V))==null||r.setItem(c(this,_),c(this,F).serialize(t))}catch(s){console.error(`Error when writing value from persisted store "${c(this,_)}" to ${c(this,V)}`,s)}};function J(e){return new Promise((t,r)=>{e.oncomplete=e.onsuccess=()=>t(e.result),e.onabort=e.onerror=()=>r(e.error)})}function Bt(e,t){const r=indexedDB.open(e);r.onupgradeneeded=()=>r.result.createObjectStore(t);const s=J(r);return(n,i)=>s.then(a=>i(a.transaction(t,n).objectStore(t)))}let re;function ge(){return re||(re=Bt("keyval-store","keyval")),re}function de(e,t=ge()){return t("readonly",r=>J(r.get(e)))}function Mt(e,t,r=ge()){return r("readwrite",s=>(s.put(t,e),J(s.transaction)))}function $t(e=ge()){return e("readwrite",t=>(t.clear(),J(t.transaction)))}async function Qt(e,t=!1,r=!1){try{let s;t?s=await de(e).then(i=>i):s=await window.showDirectoryPicker();const n=s.name;e==="v1"?(k.v.v1DirPath=n,o.v1DirFileSysHandle=s,ne("v1",s)):e==="v2"?(k.v.v2DirPath=n,o.v2DirFileSysHandle=s,ne("v2",s)):e==="convOut"&&(k.v.otherDirs.convOut=n,o.converter.outputDirFileSysHandle=s,ne("convOut",s)),xt(r)}catch{console.log("Directory picker canceled")}}async function xt(e=!1){var i;k.v.dirsOk=!1;let t=[],r=[];if(o.v1DirFileSysHandle&&(t=await Ae(o.v1DirFileSysHandle),o.v1Len=t.length),o.v2DirFileSysHandle&&(r=await Ae(o.v2DirFileSysHandle),o.v2Len=r.length),(!o.v1DirFileSysHandle||!o.v2DirFileSysHandle)&&!e)return;k.v.dirsOk=!0;const s=new Map(t.map(a=>[a.name.split(".")[0],a])),n=new Map(r.map(a=>[a.name.split(".")[0],a]));if(o.imagePairsAll=Array.from(new Set([...s.keys(),...n.keys()])).map(a=>({baseName:a,v1:s.get(a),v2:n.get(a)})),o.overlaps=o.imagePairsAll.filter(a=>a.v1&&a.v2).length,o.imagePairsAll.sort((a,l)=>a.baseName.localeCompare(l.baseName)),o.imagePairsHeic=o.imagePairsAll.filter(a=>{var l,u;return((l=a.v1)==null?void 0:l.name.match(/\.heic$/i))||((u=a.v2)==null?void 0:u.name.match(/\.heic$/i))}),o.heicCount=o.imagePairsHeic.length,o.imagePairs=o.imagePairsAll.filter(a=>{var l,u;return!((l=a.v1)!=null&&l.name.match(/\.heic$/i))&&!((u=a.v2)!=null&&u.name.match(/\.heic$/i))}),o.imagePairsHeic.length>0){const a=o.imagePairsHeic[0];o.whichFolderHeic=(i=a.v1)!=null&&i.name.match(/\.heic$/i)?"v1":"v2"}Kt(k.v.defaultSelection)}async function Ae(e){const t=[];for await(const r of e.values())r.kind==="file"&&r.name.match(/\.(png|jpg|jpeg|gif|webp|heic)$/i)&&t.push({handle:r,name:r.name,url:URL.createObjectURL(await r.getFile())});return t}function Kt(e){e===""&&o.selections.clear(),o.imagePairs.forEach(t=>{e==="v1"&&t.v1?o.selections.set(t.baseName,"v1"):e==="v2"&&t.v2&&o.selections.set(t.baseName,"v2")}),Me()}function Me(){let e=0,t=0;o.selections.forEach(r=>{r==="v1"?e++:r==="v2"&&t++}),o.status={v1:e,v2:t}}async function Yt(e){var t;if(o.selections.size)try{const r=await window.showDirectoryPicker({mode:"readwrite"});for(const[s,n]of o.selections){const a=(t=o.imagePairs.find(l=>l.baseName===s)[n])==null?void 0:t.handle;if(a){const u=await(await r.getFileHandle(a.name,{create:!0})).createWritable(),d=await a.getFile();await u.write(d),await u.close(),e&&await a.remove()}}alert("Operation completed successfully!")}catch(r){console.error("File operation failed:",r)}}function se(e,t){e==null||e==null||(o.selections.set(e,t),Me())}function Xt(){const e=o.imagePairs.findIndex(a=>{var l;return a.baseName===((l=o.currentPair)==null?void 0:l.baseName)});if(e===-1)return o.imagePairs.slice(0,k.v.itemsPerPage);const t=k.v.itemsPerPage,r=o.imagePairs.length,s=Math.floor(2/3*t);let n=Math.max(0,e-Math.floor(t/2)),i=n+t;return e>s&&(n=Math.min(r-t,e-Math.floor(t/2)),i=n+t),o.imagePairs.slice(n,i)}const q={};function Zt(e,t){const r=q[e.name]??null,s=Date.now();if(!r)q[e.name]=s;else if(s-q[e.name]<t)return()=>{};return q[e.name]=s,e}const Lt={v1DirPath:"",v2DirPath:"",v1DirName:"Dir1",v2DirName:"Dir2",otherDirs:{convOut:""},defaultSelection:"v1",itemsPerPage:20,thumbnailSize:50,spacing:10,dirsOk:!1,imageFullscreenView:!0,showNameInInfoBar:!1},k=new Ht("app-settings",Lt,{syncTabs:!1}),o=G({v1DirFileSysHandle:null,v2DirFileSysHandle:null,imagePairsAll:[],imagePairsHeic:[],imagePairs:[],v1Len:0,v2Len:0,overlaps:0,selections:new ie,currentPage:1,status:{v1:0,v2:0},heicCount:0,whichFolderHeic:"v1",currentPair:null,layout:{topBar:56,bottomBar:24,bodyArea:0,svelteInnerHeight:0,largeViewImgHeight:0},currentPairID:0,bottomBar:{show:!1,statusText:"",showId:!0},converter:{inputDirFileSysHandle:null,jpegQuality:80,outputDirFileSysHandle:null,progress:0,startTime:0}});function ne(e,t){if(!t){console.log("no handle to save");return}Mt(e,t)}async function Jt(){return{v1:await de("v1"),v2:await de("v2")}}function er(){localStorage.clear(),$t(),location.reload()}function tr(e){var t,r,s,n,i;switch(e){case"Space":case"Numpad6":j(1);break;case"Numpad4":j(-1);break;case"Numpad1":case"KeyA":(t=o.currentPair)!=null&&t.baseName&&(se((r=o.currentPair)==null?void 0:r.baseName,"v1"),j(1));break;case"Numpad3":case"KeyD":(s=o.currentPair)!=null&&s.baseName&&(se((n=o.currentPair)==null?void 0:n.baseName,"v2"),j(1));break;case"NumpadSubtract":se((i=o.currentPair)==null?void 0:i.baseName,"none");break}}function j(e){if(!o.imagePairs)return;const t=o.imagePairs.indexOf(o.currentPair);t<o.imagePairs.length-e?o.currentPair=o.imagePairs[t+e]:console.log("No more pairs to show")}function rr(e){var t,r,s;o.bottomBar.statusText=e.target.getAttribute("data-infobar")??((t=e.target.parentNode)==null?void 0:t.getAttribute("data-infobar"))??((s=(r=e.target.parentNode)==null?void 0:r.parentElement)==null?void 0:s.getAttribute("data-infobar"))??""}export{o as A,k as a,er as b,xt as c,Kt as d,Xt as e,pe as f,Jt as g,tr as h,se as i,Yt as j,rr as m,Qt as p,Gt as r,Wt as s,Zt as t};
